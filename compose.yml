version: "3.8"

services:
  gitea:
    container_name: gitea
    image: docker.gitea.com/gitea:latest
    ports:
      - "3000:3000"
      - "2222:22"
    volumes:
      - ./gitea:/data
    restart: always

  filebrowser:
    container_name: filebrowser
    image: hurlenko/filebrowser
    ports:
      - "8181:8080"
    volumes:
      - filebrowser_data:/data
    restart: always

  nginxproxymanager:
    container_name: nginxproxymanager
    image: jc21/nginx-proxy-manager:latest
    ports:
      - "80:80"
      - "81:81"
      - "443:443"
    volumes:
      - nginx_data:/data
    restart: always

  portainer:
    container_name: portainer
    image: portainer/portainer-ce:latest
    ports:
      - "9000:9000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    restart: always

  nextcloud:
    container_name: nextcloud
    image: lscr.io/linuxserver/nextcloud:latest
    ports:
      - "8080:80"
    volumes:
      - nextcloud_data:/data
    restart: always

  jellyfin:
    container_name: jellyfin
    image: lscr.io/linuxserver/jellyfin:latest
    ports:
      - "8096:8096"
      - "8920:8920"
    volumes:
      - jellyfin_config:/config
    restart: always

  navidrome:
    container_name: navidrome
    image: deluan/navidrome:latest
    ports:
      - "4533:4533"
    volumes:
      - navidrome_data:/data
    restart: always

  audiobookshelf:
    container_name: audiobookshelf
    image: ghcr.io/advplyr/audiobookshelf
    ports:
      - "13378:80"
    volumes:
      - audiobookshelf_config:/config
    restart: always

  transmission:
    container_name: transmission
    image: lscr.io/linuxserver/transmission:latest
    ports:
      - "9091:9091"
      - "51413:51413"
      - "51414:51413/udp"
    volumes:
      - transmission_downloads:/downloads
    restart: always

  deemix:
    container_name: deemix
    image: registry.gitlab.com/bockiii/deemix-docker
    ports:
      - "6595:6595"
    volumes:
      - deemix_downloads:/downloads
    restart: always

  pigallery2:
    container_name: pigallery2
    image: bpatrik/pigallery2
    ports:
      - "8082:80"
    volumes:
      - pigallery2_photos:/app/data/photos
    restart: always

  homeassistant:
    container_name: homeassistant
    image: ghcr.io/home-assistant/home-assistant:stable
    ports:
      - "8123:8123"
    volumes:
      - homeassistant_config:/config
    restart: always

  vaultwarden:
    container_name: vaultwarden
    image: vaultwarden/server:latest
    ports:
      - "9445:80"
    volumes:
      - vaultwarden_data:/data
    restart: always

  pinepods-db:
    container_name: pinepods-db
    image: postgres:latest
    environment:
      POSTGRES_DB: pinepods_database
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: myS3curepass
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - ./pinepods/pgdata:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    restart: always
    networks:
      - nginx_network

  pinepods-valkey:
    container_name: pinepods-valkey
    image: valkey/valkey:8-alpine
    ports:
      - "6378:6379"
    restart: always
    networks:
      - nginx_network

  pinepods:
    container_name: pinepods
    image: madeofpendletonwool/pinepods:latest
    ports:
      - "8040:8040"
    environment:
      HOSTNAME: 'http://localhost:8040'
      SEARCH_API_URL: 'https://search.pinepods.online/api/search'
      PEOPLE_API_URL: 'https://people.pinepods.online'
      DB_TYPE: postgresql
      DB_HOST: pinepods-db
      DB_PORT: 5432
      DB_USER: postgres
      DB_PASSWORD: myS3curepass
      DB_NAME: pinepods_database
      VALKEY_HOST: pinepods-valkey
      VALKEY_PORT: 6379
      PUID: 1000
      PGID: 1000
      TZ: "Europe/Athens"
      USERNAME: admin
      PASSWORD: admin
      FULLNAME: admin
      EMAIL: admin@admin.com
    volumes:
      - ./pinepods/downloads:/opt/pinepods/downloads
      - ./pinepods/backups:/opt/pinepods/backups
      - /etc/localtime:/etc/localtime:ro
      - /etc/timezone:/etc/timezone:ro
    depends_on:
      - pinepods-db
      - pinepods-valkey
    restart: always
    networks:
      - nginx_network

volumes:
  filebrowser_data:
  nginx_data:
  nextcloud_data:
  jellyfin_config:
  navidrome_data:
  audiobookshelf_config:
  transmission_downloads:
  deemix_downloads:
  pigallery2_photos:
  homeassistant_config:
  vaultwarden_data:

networks:
  nginx_network:
    driver: bridge
